\chapter{Optimale Zustandsrückführung}
\section{Zeitdiskrete Optimalsteuerung bei endlichen Zeithorizont}
Es wird der Prozess
\begin{align}
	x[\kappa + 1] & = f\left(x[\kappa], u[\kappa] \right)
\end{align}
betrachtet mit $x[\kappa]\in\mathbb{R}^n$, $u[\kappa]\in\mathbb{R}^m$, dem Prozesszustand $x[\kappa]:=x(\kappa T_A)$ mit der Abtastzeit $T_a$ zu
diskreten Zeitpunkten $\kappa=0,1,\ldots,k$ und gegebenen Anfangszustand $x[0]$.

Das Kostenfunktional wird mit
\begin{align}
	K\left(x[0];u[0],..,u[k-1] \right) & := \sum\limits_{\kappa=0}^{k-1}\underbrace{c\left(x[\kappa],u[\kappa] \right)}_{\begin{tabular}{c}inkrementale
	Kosten\\ im Schritt $\kappa$\end{tabular}} + \underbrace{K_k(x[k])}_{\begin{tabular}{c}Endwertkosten\end{tabular}}
\end{align}
angenommen.\\
Die Aufgabe besteht in der Minimierung des Kostenfunktionals
\begin{align}
	\min\limits_{u[0],\ldots,u[k-1]}K\left(x[0];u[0],\ldots,u[k-1]\right).
\end{align}
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Darstellung des k-stetigen Entscheidungsprozesses}
	\label{fig:kap_3_entscheidungsprozess}
\end{figure}
Es werden die minimalen Restkosten im Schritt $\kappa=0,\ldots,k$ wie folgt definiert 
\begin{align}
	V\left(x[\kappa],\kappa \right) & := \min\limits_{u[\kappa],\ldots,u[k-1]}\left\{\sum\limits_{i=\kappa}^{k-1} c\left(x[i],u[i] \right) +
	K_k(x[k])\right\}.
\end{align}
Man beachte, dass $V\left(x[k],k\right)=K_k(x[k])$ ist und dann die Minimalkosten
\begin{align*}
	V\left(x[0],0 \right) & = \min K\left(x[0];u[0],\ldots,u[k-1] \right)
\end{align*}
sind. Es gilt für $\kappa=k-1,\ldots,0$
\begin{align}
	V\left(x[\kappa],\kappa \right) & = \min\limits_{u[\kappa],\ldots,u[k-1]}\left\{ c\left(x[\kappa],u[\kappa] \right)+\sum\limits_{i=\kappa+1}^{k-1} \ldots
	\right\}\\
	& = \min\limits_{u[\kappa]}\left\{\min\limits_{u[\kappa + 1],\ldots,u[k-1]}\left(c\left(x[\kappa],u[\kappa] \right) + \sum\limits_{i=\kappa +
	1}^{k-1} \ldots\right) \right\}\\
	& = \min\limits_{u[\kappa]}\Bigg\{c\left(x[\kappa], u[\kappa] \right) + \min\limits_{u[\kappa
	+1],\ldots,u[k-1]}\underbrace{\sum\limits_{i=\kappa+1}^{k-1}\ldots}_{V\left(x[\kappa+1],\kappa+1 \right)} \Bigg\}\\
	& = \min\limits_{u[\kappa]}\left\{c\left(x[\kappa],u[\kappa] \right)+V\left(f\left(x[\kappa],u[\kappa] \right),\kappa+1 \right)
	\right\}.\label{eqn:kap_3_dp}
\end{align}
Gleichung \eqnref{eqn:kap_3_dp} entspricht der Gleichung der \ac{DP} und kann in Kurzform wie folgt dargestellt werden
\begin{align}
	V(x,x) & = \min\limits_u\left(c(x,u)+V\left(f(x,u),\kappa +1 \right) \right)
\end{align}
\begin{remark}\hspace{1mm}
\begin{itemize}
  \item Optimale Steuerfolge $u^{\ast}[\kappa],\ldots,u^{\ast}[k-1]$ zum Erreichen der minimalen Restkosten $V\left(x[\kappa],\kappa \right)$ ist allein von $x[\kappa]$ abhängig, also
  ist die Kenntnis von $u[0],\ldots,u[k-1]$ nicht erforderlich.
  \item Es gilt das Optimalitätsprinzip von Bellmann:\\
  	Sei $u^{\ast}[\kappa],\ldots,u^{\ast}[k-1]$ optimale Steuerfolge für den Prozess mit Anfangszustand $x[\kappa]$, dann ist $u^{\ast}[\kappa+1],\ldots,u^{\ast}[k-1]$ optimale
  	Steuerfolge für den Prozess mit dem Anfangszustand $f\left(x[\kappa],u^{\ast}[\kappa] \right)$.
\end{itemize}
\end{remark}
Anwendung der Gleichung der \ac{DP} zur Bestimmung einer optimalen Steuerfolge

Rekursive Rückwärtsrechnungen
\begin{enumerate}[label=(S\arabic*)]
  \item Berechne
  \begin{align*}
  	V\left(x[k-1],k-1 \right) & = \min\limits_{u[k-1]}\left\{c(x[k-1],u[k-1]) + K_k\left(f(x[k-1],u[k-1]) \right) \right\}
  \end{align*}
  sowie Funktion
  \begin{align*}
  	\pi_{k-1} & := x[k-1]\mapsto u^{\ast}[k-1],
  \end{align*}
  d.h. 
  \begin{align*}
  	\pi_{k-1}\left(x[k-1] \right) & = u^{\ast}[k-1].
  \end{align*}
  \item Für $\kappa=k-2,\ldots,0$ berechne 
  \begin{align*}
  	V\left(x[\kappa],\kappa \right) & = \min\limits_{u[\kappa]}\left\{c\left(x[\kappa],u[\kappa] \right) + V\left(f(x[\kappa],u[\kappa],\kappa +1) \right) \right\},
  \end{align*}
  sowie
  \begin{align*}
  	\pi_{\kappa} & := x[\kappa]\mapsto u^{\ast}[\kappa].
  \end{align*}
\end{enumerate}
Rekursive Vorwärtsrechnung
\begin{enumerate}[label=(S\arabic*),resume] 
  \item Zu gegebenen $x[0]$ bestimme für $\kappa=0,1,\ldots,k-1$
  \begin{align*}
  	u^{\ast}[\kappa] & = \pi_{\kappa}(x[\kappa]).
  \end{align*}
\end {enumerate} 

\begin{remark}\hspace{1mm}
\begin{itemize}
  \item $\pi$ ist die Zustandsrückführung. Es ist die Prozessgleichung notwendig. Vor- und Rückwärtsrechnung durchführen, danach sind diese für beliebige Anfangswerte
  anwendbar. Die Rückführungen bleiben. Bei Änderung von einem $u[\kappa]$ muss nur neu eingesetzt werden, daher ist dieser Algorithmus sehr effizient.
  \item \ac{NB} der Form $u[\kappa]\in U_{\kappa}\subset\mathbb{R}^m$, $x[\kappa]\in X_{\kappa}\subset\mathbb{R}^n$ sind möglich.\\
  Speziell sind zum Beispiel Endwertbedingungen der Form $x[k]=x_{end}$ mit gegebenen $x_{end}$.
  \item Zeitvariante Prozesse $x[\kappa+1]=f(x[\kappa],u[\kappa],\kappa)$ und zeitvariante inkrementale Kosten $c(x[\kappa],u[\kappa],\kappa)$ sind möglich.Dann ist Kostenfunktion der
  \ac{DP}
  \begin{align*}
  	V(x,\kappa) & = \min\limits_u\left(c(x,u,\kappa)+V\left(f(x,u,\kappa), \kappa +1 \right) \right).
  \end{align*}
\end{itemize}
\end{remark}
\begin{exmp}\label{exmp:kap_3_zeitdis_opt_1}
Der Prozess ist gegeben mit
\begin{align*}
	x[\kappa + 1] & = \frac12\left(x[\kappa]+u[\kappa] \right)
\end{align*}
und der Anfangsbedingung $x[0]=4$, sowie dem Zeithorizont $k=3$. Der Endwert ist gegeben mit $x[3]=0$ und das Kostenfunktional mit
\begin{align}
	K\left(x[0];u[0],u[1],u[2] \right) & = \sum\limits_{\kappa=0}^2\left(x[\kappa]^2+u[\kappa]^2 \right).
\end{align}
Für die Berechnung der optimalen Steuerfolge und Zustandstrajektorie wird als erstes die Rückwärtsrechnung schrittweise durchgeführt. 
\begin{enumerate}[label=(S\arabic*)]
  \item Mit $k=3$ und keinen Endwertkosten $K_3$, da Endwert mit $x[3]=0$ gegeben, ergibt sich
\begin{align*}
	V\left(x[k-1],k-1\right) & = \min\limits_{u[k-1]}\left\{c\left(x[k-1],u[k-1]\right) + K_k\left(f(x[k-1],u[k-1]) \right) \right\}\\
	V\left(x[2],2\right) & = \min\limits_{u[2]}\left\{x[2]^2+u[2]^2\bigg| x[3]=0 \right\}\\
	x[3] & = \frac12 \left(x[2] + u[2] \right)\quad \Rightarrow\quad u[2] = -x[2]\\
	V\left(x[2],2\right) & = x[2]^2 + \left(-x[2]\right)^2 = 2x[2]^2
\end{align*}
Damit ist der optimale Steuerwert $u^{\ast}[2]=-x[2]$, $V\left(x[2],2\right)=2x[2]^2$ und die Zustandsrückführung
$\pi_2\left(x[2]\right)=-x[2]=u^{\ast}_2[2]$.
  \item Mit $\kappa=k-2=1$ lässt sich
  \begin{align*}
  	V\left(x[\kappa],\kappa\right) & = \min\limits_{u[\kappa]}\left\{c\left(x[\kappa],u[\kappa]\right)+V\left(f\left(x[\kappa],u[\kappa]
  	\right),\kappa+1 \right) \right\}\\ 
  	V\left(x[1], 1 \right) & = \min\limits_{u[1]}\underbrace{\left\{x[1]^2+u[1]^2 + V\left(x[2], 2 \right) \right\}
  	}_{=:\nu_1}\\
  	& = \min\limits_{u[1]}\underbrace{\left\{x[1]^2+u[1]^2 + 2\left(\frac12\left(x[1]+u[1] \right) \right)^2 \right\}
  	}_{=:\nu_1}\\
  	\frac{\d \nu_1}{\d u[1]} & = x[1]+3u[1]=0\quad \Rightarrow\quad u[1]=-\frac{x[1]}{3}\\
  	\left.\frac{\d^2 \nu_1}{\d u[1]^2}\right|_{u[1]} & = 3 > 0 \quad \Rightarrow\quad\text{Minimum!}\\
  	V\left(x[1], 1 \right) & = x[1]^2 + \left(-\frac13x[1]\right)^2 + 2\left(\frac12\left(x[1] -\frac13x[1] \right)\right)^2=\frac43x[1]^2
  \end{align*}  
  ermitteln. Damit ist $u^{\ast}[1]=-\frac13x[1]$, $V\left(x[1],1\right)=\frac43x[1]^2$ und die Zustandsrückführung
  $\pi_1\left(x[1]\right)=-\frac13x[1]=u^{\ast}_1[1]$.\\
  Weiter wird mit $\kappa=k-3=0$
  \begin{align*}
  	V\left(x[\kappa],\kappa\right) & = \min\limits_{u[\kappa]}\left\{c\left(x[\kappa],u[\kappa]\right)+V\left(f\left(x[\kappa],u[\kappa]
  	\right),\kappa+1 \right) \right\}\\ 
  	V\left(x[0], 0 \right) & = \min\limits_{u[0]}\underbrace{\left\{x[0]^2+u[0]^2 + V\left(x[1], 1 \right) \right\}
  	}_{=:\nu_0}\\
  	& = \min\limits_{u[0]}\underbrace{\left\{x[0]^2+u[0]^2 + \frac43\left(\frac12\left(x[0]+u[0] \right) \right)^2 \right\}
  	}_{=:\nu_0}\\
  	\frac{\d \nu_0}{\d u[0]} & = \frac23x[0]+\frac83u[0]=0\quad \Rightarrow\quad u[0]=-\frac{x[0]}{4}\\
  	\left.\frac{\d^2 \nu_0}{\d u[0]^2}\right|_{u[0]} & = 8 > 0 \quad \Rightarrow\quad\text{Minimum!}\\
  	V\left(x[0], 0 \right) & = x[0]^2 + \left(-\frac14x[0]\right)^2 + \frac43\left(\frac12\left(x[0] -\frac14x[0] \right)\right)^2=\frac54x[0]^2  
  \end{align*}
  der letzte Wert für die optimale Steuerfolge berechnet. Damit ergibt sich $u^{\ast}[0]=-\frac14x[0]$, $V\left(x[0],0\right)=\frac54x[0]^2$ und die
  Zustandsrückführung $\pi_0\left(x[0],0 \right)=-\frac14x[0]=u^{\ast}_0[0]$.
\end{enumerate}
Mit den Ergebnissen der Rückwärtsrechnung kann mittels der Vorwärtsrechnung die optimale Steuerfolge und
Zustandstrajektorie berechnet werden
\begin{align*}
& && & x^{\ast}[0] & = 4\\
u^{\ast}[0] & = -\frac14\cdot 4 = -1 && \Rightarrow  &x^{\ast}[1]& = \frac12\cdot(4-1)=\frac32\\
u^{\ast}[1] & = -\frac13\cdot\frac32=-\frac12 && \Rightarrow  &x^{\ast}[2]& = \frac12\cdot\left(\frac32 -\frac12\right)=\frac12\\
u^{\ast}[2] & = -\frac12 && \Rightarrow  &x^{\ast}[3]& = \frac12\cdot\left(\frac12 - \frac12\right)=0.
\end{align*}
\end{exmp}
\begin{exmp}\label{exmp:kap_3_zeitdis_opt_2}
Benutzt den selben Prozess wie \exmpref{exmp:kap_3_zeitdis_opt_1}. Hat aber keine Endwertbedingung, dafür Endwertkosten und zusätzliche
Steuergrößenbeschränkungen $-1\leq u[\kappa]\leq 1$ für $\kappa=0,1,2$ und das Kostenfunktional
\begin{align*}
	K\left(x[0];u[0],u[1],u[2]\right) & = \sum\limits_{\kappa=0}^2\left(x[\kappa]^2+u[\kappa]^2 \right) + x[3]^2.
\end{align*}
Für die Berechnung der optimalen Steuerfolge und Zustandstrajektorie wird als erstes die Rückwärtsrechnung schrittweise durchgeführt. 
\begin{enumerate}[label=(S\arabic*)]
  \item Mit $k=3$ ergibt sich
\begin{align*}
	V\left(x[2],2\right) & = \min\limits_{u[2]}\left\{c\left(x[2],u[2]\right) + K_3\left(f(x[2],u[2]) \right)\bigg| -1\leq u[2]\leq 1 \right\}\\
	V\left(x[2],2\right) & = \min\limits_{u[2]}\bigg\{\underbrace{x[2]^2+u[2]^2+\left(\frac12\left(x[2]+u[2]\right) \right)^2}_{=:\nu_2} \bigg| -1\leq
	u[2] \leq 1 \bigg\}\\
	\frac{\d \nu_2}{\d u[2]} & = x[2]+5u[2]=0\quad \Rightarrow \quad u[2]=-\frac{x[2]}{5}\\
	\left.\frac{\d^2 \nu_2}{\d u[2]^2}\right|_{u[2]} & = 5 > 0 \quad \Rightarrow\quad\text{Minimum!}\\
	u^{\ast}[2] & = \left\{\begin{array}{rl}
	1 & \text{für } x[2]\leq -5\\
	-\frac{x[2]}{5} & \text{für } x[2]\in(-5,5)\\
	-1 & \text{für } x[2]\geq 5
	\end{array} \right.\\
	V\left(x[2],2\right) & = \left\{\begin{array}{rl}
	\frac54x[2]^2+\frac12x[2]+\frac54 & \text{für } x[2]\leq -5\\
	\frac65x[2]^2 & \text{für } x[2]\in(-5,5)\\
	\frac54x[2]^2-\frac12x[2]+\frac54 & \text{für }x[2]\geq 5
	\end{array}
	\right.
\end{align*}
	\item Mit $\kappa = k - 2 = 1$ ergibt sich
\begin{align*}
	V\left(x[1],1\right) & = \min\limits_{u[1]}\left\{c\left(x[1],u[1]\right) + K_2\left(f(x[1],u[1]) \right)\bigg| -1\leq u[1]\leq 1 \right\}\\
	V\left(x[1],1\right) & = \left\{\begin{array}{l}
	\min\limits_{u[1]}\bigg\{\underbrace{x[1]^2+u[1]^2+\frac54x[2]^2+\frac12x[2]+\frac54}_{=:\nu_{1.1}} \bigg| -1\leq u[1]\leq 1\bigg\}\\
	\min\limits_{u[1]}\bigg\{\underbrace{x[1]^2+u[1]^2+\frac65x[2]^2}_{=:\nu_{1.2}} \bigg| -1\leq u[1]\leq 1\bigg\}\\
	\min\limits_{u[1]}\bigg\{\underbrace{x[1]^2+u[1]^2+\frac54x[2]^2-\frac12x[2]+\frac54}_{=:\nu_{1.3}} \bigg| -1\leq u[1]\leq 1\bigg\}
	\end{array}\right.
\end{align*}
\end{enumerate}
Analog wie in \exmpref{exmp:kap_3_zeitdis_opt_1} weiterrechnen. Durch die Steuergrößenbeschränkung müssen für jedes $_nu_1,i$ mit $i=1,\ldots,3$
jeweils drei Fuktionen ausgewertet werden und im nächsten Schritt wieder weitere drei pro Funktion.
\end{exmp}

\subsection{Numerische Durchführung des Algorithmus der Dynamsichen Programmierung}
Sei $x[\kappa+1] = f\left(x[\kappa],u[\kappa] \right)$ mit $x[\kappa]\in\mathbb{R}^1$, $u[\kappa]\in\mathbb{R}^1$ und das Kostenfunktional
\begin{align*}
	K\left(x[0];u[0],\ldots,u[\kappa-1] \right) & = \sum\limits_{k=0}^{\kappa-1}c\left(x[k],u[k] \right)+K_k([k]).
\end{align*}
Dann kann über eine diskrete Darstellung von $x[\kappa]$ in Form eines Gitters, wie in \figref{fig:kap_3_dyn_prog_xgitter} dargestellt, sowie von
$u[\kappa]$ auf die Restkosten $V(x_i,\kappa)$ geschlossen werden, vgl. \tabref{tab:kap_3_dyn_prog_restkosten}. Mit den diskreten Restkosten kann dann
auf die optimale Steuerfolge $u^{\ast}[x_i,\kappa]$ geschlossen werden, siehe \tabref{tab:kap_3_dyn_prog_optu}. Bei der Betrachtung von $x_1$ im
Schritt $k-1$ werden die Restkosten mit der \textsc{NumPy}-Funktion \lstinline[columns=fixed]{interp} ausgewertet
\begin{figure}[!htb]
	\centering
	\input{tikz/kap_3_dyn_prog_xgitter}
	\caption{Darstellung der Diskretisierung von $x[\kappa]$ in Gitterform}
	\label{fig:kap_3_dyn_prog_xgitter}
\end{figure}
\begin{align*}
	V\left(x_1, k-1 \right) & = \min\left\{c\left(x_1,u_j \right)\right.\\
	& \quad + \left.\text{\lstinline[columns=fixed]{interp}}\left(f(x_1,u_j),\left[x_1,\ldots,x_N\right],\left[K_k[x_1],\ldots,K_k[x_N] \right] \right)
	\right\}\\
	& \rightarrow u^{\ast}(x_i,\kappa).
\end{align*}
Wenn $x_i$ im Schritt $\kappa$ mit $i=1,\ldots,N$ und $\kappa=k-1,\ldots,0$ betrachtet wird, folgt
\begin{align*}
	V\left(x_i,\kappa \right) & = \min\limits_{j=1,\ldots,N}\left\{c\left(x_i,u_j \right)\right.\\
	&\quad + \left.\text{\lstinline[columns=fixed]{interp}}\left(f(x_i,u_j), \left[x_1,\ldots,x_N \right],\left[V(x_1,\kappa+1),\ldots,V(x_N,\kappa+1)
	\right] \right) \right\}\\
	& \rightarrow u^{\ast}(x_i,\kappa).
\end{align*}
\begin{table}[htb]
\caption{Berechnung der diskretisierten Restkosten $V(x_i,\kappa)$}
\centering
\begin{tabular}{|c|cccc|}
	\hline
	\diagbox{$i$}{$\kappa$} 	& $0$ 	& $\ldots$ 	& $k-1$ 		& $k$\\\hline
	$1$							&		&			& $V(x_1,k-1)$	& $K_k(x_1)$\\
	$\vdots$					&		&			& $\vdots$		& $\vdots$\\
	$N$							&		&			& $V(x_N,k-1)$	& $K_k(x_N)$\\\hline
\end{tabular}
\label{tab:kap_3_dyn_prog_restkosten}
\end{table}
\begin{table}[htb]
\caption{Berechnung der diskretisierten optimalen Steuerfolge $u^{\ast}(x_i,\kappa)$}
\centering
\begin{tabular}{|c|ccc|}
	\hline
	\diagbox{$i$}{$\kappa$} 	& $0$ 	& $\ldots$ 	& $k-1$\\\hline
	$1$							& 		& 			& $u^{\ast}(x_1,k-1)$\\
	$\vdots$					& 		& 			& $\vdots$\\
	$N$							& 		& 			& $u^{\ast}(x_N,k-1)$\\\hline
\end{tabular}
\label{tab:kap_3_dyn_prog_optu}
\end{table}
\begin{exmp}
Der Prozess ist beschrieben durch
\begin{align}
	x[\kappa + 1] & = \frac{1}{2}\left(x[\kappa]+u[\kappa] \right)
\end{align}
mit der Anfangsbedingung $x[0] = 4$ und dem zeithorizont $k=3$. Die Steuergrößenbeschränkungen sind gegeben mit $-1\leq u[\kappa]\leq 1$ für $\kappa =
0,1,2$. Das Kostenfunktional ist gegeben mit
\begin{align}
	K\left(x[0];u[0],u[1],u[2] \right) & = \sum\limits_{\kappa = 0}^2\left(x[\kappa]^2+u[\kappa]^2 \right) + x[3]^2.
\end{align}
\begin{lstlisting}[style=PythonStyle, caption=Numerische Algorithmus der \ac{DP} am \exmpref{exmp:kap_3_zeitdis_opt_2}, label=code:kap_3_sec_1_num_dp] 
import numpy as np

# Rueckwaertsrechnung
x0 = 4
K = 3
uGitter = np.arange(-1, 1.1, 0.1)
xGitter = np.arange(0, 4.1, 0.1)
nu = len(uGitter)
nx = len(xGitter)

V = np.zeros([nx, K+1])
V[:, K] = xGitter**2
U = np.zeros([nx, K])

for k in np.arange(K, 0, -1)-1:
    for i in range(nx):
        Kosten = np.array([])
        for j in range(nu):
            xFolge = (xGitter[i] + uGitter[j])/2
            tKosten = xGitter[i]**2 + uGitter[j]**2 +\
                np.interp(xFolge,
                          xGitter,
                          V[:,k+1],
                          np.inf,
                          np.inf)
            Kosten = np.append(Kosten, tKosten)
        minval = np.min(Kosten)
        minind = np.argmin(Kosten)
        V[i][k] = minval
        U[i][k] = uGitter[minind]

# Vorwaertsrechnung
x = np.array([x0])
u = np.array([])
for k in range(K):
    u = np.append(u, np.interp(x[k], xGitter, U[:,k]))
    x = np.append(x, (x[k] + u[k])/2.0)

print u
print x
\end{lstlisting}  
Im Skript \ref{code:kap_3_sec_1_num_dp} entspricht $K\hat{=}k$, $nx=\hat{=}N$, $nu\hat{=}M$ und $k\hat{=}\kappa$ und dieser liefert die (im
Rahmen der Diskretisierung) optimale Steuerfolge
\begin{align*}
	u & = \left[u_0, u_1, u_2\right] = \left[-1.00, -0.30, -0.10\right]
\end{align*}
und Zustandstrajektorie
\begin{align*}
	x & = \left[x_0,x_1,x_2,x_3 \right]=\left[4.00,1.50,0.60,0.25 \right].
\end{align*}
\end{exmp}
Der Rechenaufwand des Algorithmus beträgt
\begin{itemize}
  \item $k\cdot M\cdot N$ - Berechnungen von $c(x,u)+V\left(f(x,u),\kappa+1 \right)$ für die \ac{DP},
  \item $k\cdot M^k$ - Berechnungen von $c(x,u)$ und $f(x,u)$
  \item $M^k$ - Berechnungen von $K_k(x)$ \hphantom{ $c(x,u)$ und $f(x,u)$}
  \llap{\smash{\raisebox{\dimexpr0.5\normalbaselineskip+\jot}{$\left.\begin{array}{c}\null\\[\jot]\null\end{array}\right\}\quad$}}}
      \text{\smash{\raisebox{\dimexpr0.5\normalbaselineskip+\jot}{\begin{tabular}{l}
      für vollständige Enumeration\\ bei geg. $x[0]$
      \end{tabular} }}}
\end{itemize}
Minimierungsfunktion ist parallelisierbar.

\section{Das zeitdiskrete \NoCaseChange{\acl{LQR}}-Problem}
Der Prozess wird beschrieben durch
\begin{align}
	x[\kappa + 1] & = Ax[\kappa] + B u[\kappa]
\end{align}
mit gegebenen Anfangszustand $x[0]$.\\
Das Kostenfunktional ist gegeben mit
\begin{align}
	K\left(x[0];u[0],\ldots,u[k-1] \right) & = \sum\limits_{\kappa=0}^{k-1}c\left(x[\kappa],u[\kappa] \right) + K_k(x[\kappa])
\end{align}
wobei $c(x,u):=x^TRx + u^TQu$ und $K_k(x):=x^TX_kx$ ist und $R\geq0$, $Q>0$ und $X_k\geq 0$ gilt.\\
Das \ac{LQR}-Problem wird ausgedrückt durch
\begin{align}
	\min\limits_{u[0],\ldots,u[k-1]}K\left(x[0];u[0],\ldots,u[k-1] \right).
\end{align}
\begin{satz}{Hilfssatz über quadratische Formen}\label{satz:kap_3_quad_form}
Seien $R$, $Q$ symmetrische Matrizen und $Q>0$, dann gilt
\begin{align}
	\min\limits_u\left\{\begin{bmatrix}
	x^T	& u^T
	\end{bmatrix}\begin{bmatrix}
	K	&	S^T\\ S	&	Q
	\end{bmatrix}\begin{bmatrix}
	x\\ u
	\end{bmatrix} \right\} & = x^T\left(R-S^TQ^{-1}S \right)x
\end{align}
und das Minimum wird angenommen für $u=-Q^{-1}Sx$.
\end{satz}
\begin{proof}
Es gilt 
\begin{align}
	\MoveEqLeft x^TRx + x^TS u + u^TS x + u^TQ u\\ 
	& = x^T\left(R-S^TQ^{-1}S \right)x + \left(u^T + x^TS^TQ^{-1} \right)\underbrace{Q\left(u + Q^{-1}Sx \right) }_{=:y}\\
	& \geq x^T \left(R-S^TQ^{-1}S \right)x,
\end{align}
da $y^TQy\geq 0\ \forall y$ ($Q^{-1}$ existiert, da $Q>0$ und positiv definit). Für $u=-Q^{-1}Sx$ gilt "`="'.
\end{proof}
\begin{satz}
Das \ac{LQR}-Problem wird gelöst durch $u^{\ast}[\kappa]=F_{\kappa}x[\kappa]$ mit der zeitvarianten Rückführung 
\begin{align*}
	F_{\kappa} & = -\left(Q + B^TX_{\kappa + 1}B \right)^{-1}B^TX_{\kappa + 1}A
\end{align*}
und der Riccatischen Rückwärts-Differentialgleichung
\begin{align}
	X_{\kappa} & = R + A^TX_{\kappa + 1}A-A^TX_{\kappa + 1} B\left(Q+B^TX_{\kappa + 1}B \right)^{-1}B^TX_{\kappa + 1} A 
\end{align}
mit $\kappa = k-1, k-2,\ldots,0$.
\end{satz}
\begin{proof}
	Es gilt $V(x,k)=x^TX_kx$. Mit der Gleichung der \ac{DP} und \satzref{satz:kap_3_quad_form} folgt für $\kappa = k$
	\begin{align*}
		V(x,\kappa - 1) & = \min\limits_u\left\{c(x,u)+V\left(f(x,u),\kappa \right) \right\}\\
		& = \min\limits_u\left\{x^TRx + u^TQu + V\left(Ax + Bu, \kappa \right) \right\}\\
		& = \min\limits_u\underbrace{\left\{x^TRx + u^TQu + (Ax+Bu)^TX_{\kappa}(Ax+Bu) \right\}}_{\geq 0}\\
		& = \min\limits_u\left\{\begin{bmatrix}
		x^T & u^T
		\end{bmatrix}\begin{bmatrix}
		R+A^TX_{\kappa}A	& A^TX_{\kappa} B\\
		B^TX_{\kappa} A		& Q+B^TX_{\kappa}B
		\end{bmatrix}\begin{bmatrix}
		x\\ u
		\end{bmatrix} \right\}\\
		& = x^T\underbrace{\left(R+A^TX_{\kappa}A - A^TX_{\kappa}B\left(Q+B^TX_{\kappa}B \right)^{-1}B^TX_{\kappa}A \right)}_{X_{\kappa +1}}x\\
		& = x^TX_{\kappa +1}x \geq 0,
	\end{align*}
	weil gilt
	\begin{align*}
		\underbrace{y^T\left(Q+B^TX_{\kappa}B \right)y}_{> 0\ \forall y\neq 0} & =
		\underbrace{y^TQy}_{>0}+\underbrace{\underbrace{y^TB^T}_{=z^T}X_{\kappa}\underbrace{By}_{=z} }_{\geq 0}
	\end{align*}
	und die Minimierung wird angenommen für $u = \underbrace{-\left(Q+B^TX_{\kappa}B \right)^{-1}BX_{\kappa}A}_{=F_{\kappa - 1}}x$ also
	$u^{\ast}[\kappa - 1]=F_{\kappa - 1}x[\kappa - 1]$. Weiter gilt $X_{\kappa - 1}\geq 0$ (positiv semidefinit).\\
	Analog gilt die Durchführung für $\kappa=k-1,\ldots,1$.\\
	Im Kern des Beweises ist die Nutzung der Gleichung der \ac{DP} anwendbar.
\end{proof}
\begin{remark}\hspace{1mm}
\begin{itemize}
  \item $u^{\ast}[\kappa]=F_{\kappa}x[\kappa]$ kann als zeitvariante lineare Zustandsrückführung interpretiert werden. 
  \item Eine analoge Herleitung für zeitvariante Prozess
  \begin{align*}
  	x[\kappa + 1] & = A_{\kappa}x[\kappa] + B_{\kappa}u[\kappa]
  \end{align*}
  und zeitvariante Gewichtungen $R_{\kappa}$ und $Q_{\kappa}$ ist möglich.
\end{itemize}
\end{remark}
Es ist eine Übung unter \picref{sec:uebung_zeitdiskretes_lqr_problem}{Das zeitdiskrete LQR-Problem} im Anhang zu finden.

\subsection{Übergang zu unendlichem Zeithorizont}
Das Kostenfunktional ist gegeben mit
\begin{align}
	K\left(x[0];u[0],u[1],\ldots \right) & := \sum\limits_{\kappa=0}^{\infty}c\left(x[\kappa],u[\kappa] \right),
\end{align}
wobei $c(x,u):=x^TRx + u^TQu$ ist und $R\geq 0$ und $Q>0$ gilt.\\
Das \ac{LQR}-Problem wird ausgedrückt durch
\begin{align*}
	\min\limits_{\left\{u[\kappa]|\kappa=0,1,\ldots \right\}} K\left(x[0];u[0],u[1],\ldots \right).
\end{align*} 
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Interpretation des Lösungszuganges beim Übergang zum unendlichen Zeithorizont}
	\label{fig:kap_3_loesungszugang}
\end{figure}
Man kann zeigen, dass falls $(A,B)$ stabilisierbar ist, die Folge der Lösungen der Riccatischen Rückwärts-Differentialgleichung $X_{\kappa}$ für $\kappa=k-1,k-2,\ldots$ gegen ein $X\geq
0$ konvergiert und somit die
\ac{DARE} 
\begin{align*}
	X & = R + A^TXA - A^TXB\left(Q + B^TXB \right)^{-1}B^TXA
\end{align*}
erfüllt ist. 

\begin{satz}
Sei $(A,B)$ stabilisierbar und $R=\bar{R}^T\bar{R}$, $(A,\bar{R})$ ermittelbar. Dann existiert eine eindeutige, positive semidefinite Lösung $X$ der \ac{DARE}. Weiter ist die
Rückkoppelung $u[\kappa]=F x[\kappa]$ mit $F:=\left(Q+B^TXB \right)^{-1}B^TXA$, stabilisierend, d.h $A+BF$ ist stabil, und führt zum minimalen Wert des Kostenfunktionals.
\end{satz}
Der Beweis dieses Satzes ist in \cite{ludyk1995theoretische} nachzulesen.
\begin{remark}\hspace{1mm}
\begin{itemize}
  \item Bei Übergang zu endlichem Zeithorizont gilt für $\kappa\rightarrow -\infty:\ X_{\kappa}\rightarrow X$ und $F_{\kappa}\rightarrow F$, also ergibt sich eine zeitinvariante
  Zustandsrückführung.
  \item Doe Bestimmung von $X$ erfolgt rekursiv mittels der Riccatischen Rückwärts-Differentialgleichung oder besser durch numerische Lösung der \ac{DARE}.
  \item "`$(A,\bar{R})$ ermiitelbar"' kann derart interpretiert werden, dass alle instabilen Eigenbewegungen im Term $x^TRx$ mit positiver Geschwindigkeit erfallst werden müssen. Die
  Bestimmung eines $\bar{R}$ kann durch \ac{SVD} $R=V\sum V^T$, $\bar{R}:=\sum^{\nicefrac12}V^T$ erfolgen. 
\end{itemize}
\end{remark}

\section{Zeitkontinuierliche Optimalsteuerng bei endlichen Zeithorizont}
\label{sec:3_3_zeitkont_opt_endl}
Der Prozess wird beschrieben durch
\begin{align}
	\dot{x} & = f(x,u,t)
\end{align}
mit $x(t)\in\mathbb{R}^n$, $u(t)\in\mathbb{R}^m$, $t\in[0,T]$ und gegebenen Anfangszustand $x(0)$.\\
Das Kostenfunktion ist gegeben mit
\begin{align}
	K(x(0),u) & = \int\limits_0^T c(x,u,t)dt + K_T(x(T)).
\end{align}
Die Aufgabe besteht darin, eine Steuerung $u^{\ast}$ zu finden, so dass $K\left(x(0,u^{\ast}) \right)$ minimal wird.
\subsection{Lösungsprinzip}
Es wird die kontinuierliche Zeit $t$ diskretisiert, so dass $t=\kappa\cdot h$, mit der Schrittweite $h$, $h>0$, gilt. Damit erfolgt die Approximation durch ein zeitdiskretes Problem. 
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Lösungsprinzip der zeitkontinuierlichen Optimalsteuerung bei endlichem Zeithorizont}
	\label{fig:kap_3_loesungsprinzip}
\end{figure}
Die Anwendung der Gleichung der \ac{DP} 
\begin{align}
	V(x,\kappa) & = \min\limits_{u}\left(c^D(x, u, \kappa) + V\left(f^D(x, u ,\kappa),\kappa+1 \right) \right)
\end{align}
und der Grenzübergang von $h\rightarrow +0$ liefert in kontinuierlicher Zeit ein Analogen zur Gleichung der \ac{DP}.

\subsection{Lösung}
In die Gleichung der \ac{DP} setzt man $V(x, \kappa) := \min\limits_{u(.)|_{[t,T]}} \int\limits_t^T c(x, u, \tau)d\tau + K_T\left(x(T) \right)$, $V\left(f^D(x, u, \kappa),\kappa + 1
\right) := V\left(x(t+h),t+h \right)$ und $c^D(x,u,\kappa):=\int\limits_t^{t+h}c(x,u,\tau)d\tau$. 
\begin{remark}
Differentiation nach variabler oberer Grenze $\frac{\td }{\td y}\int\limits_a^y f(t)dt=f(y)$. Also für $g:=y\mapsto\int\limits_t^y c(x,u,\tau)d\tau$ gilt $g'=y\mapsto c(x,u,y)$ und
$g'(t)=x(x,u,t)$.\\
Es wird definiert $r(x)=o(\gamma(x))$ für $x\rightarrow a\ :\Leftrightarrow\frac{r(x)}{\gamma(x)}\rightarrow 0$ für $x\rightarrow a$ was für den hier betrachtet Fall zu $r(h)=o(h)$ für
$h\rightarrow 0\ :\Leftrightarrow\frac{r(h)}{h}\rightarrow 0$ für $h\rightarrow 0$ führt.
\end{remark}
Für die in $[t,t+h]$ auflaufenden Kosten gilt
\begin{align}
	\underbrace{\int\limits_t^{t+h}c(x,u,\tau)d\tau }_{=g(t+h)} & = \underbrace{\int\limits_{t}^tc(x,u,\tau)d\tau }_{=0}+c(x,u,t)+o(h)\\
	g(t+h) & = g(t) + g'(t)\cdot h + o(h)
\end{align}
und für die minimalen Restkosten zum Zeitpunkt $t+h$ gilt
\begin{align}
	V\left(x(t+h),t+h \right) & = V(x,t)+\frac{\d V(x,t)}{\d x}f(x,u,t)\cdot h + \frac{\d V(x,t)}{\d t}\cdot h + o(h).
\end{align}
Also gilt
\begin{align}
	V(x,t) & = \min\limits_u\left(c(x,u,t)\cdot h + V(x,t) + \frac{\d V(x,t)}{\d x}f(x,u,t)\cdot h + \frac{\d V(x,t)}{\d t}\cdot h + o(h) \right).
\end{align}
Die Subtraktion von $V(x,t)+\frac{\d V(x,t)}{\d t}\cdot h$ und die Division durch $h$ liefert 
\begin{align}
	-\frac{\d V(x,t)}{\d t} & = \min\limits_u\left(c(x,u,t) + \frac{\d V(x,t)}{\d x}f(x,u,t)+\frac{o(h)}{h} \right).
\end{align}
Für $h\rightarrow +0$ ergibt sich die \ac{HJB}-Gleichung 
\begin{align*}
	-\frac{\d V(x,t)}{\d t} & = \min\limits_u\left(c(x,u,t) + \frac{\d V(x,t)}{\d x}f(x,u,t) \right).	
\end{align*}
und es gilt $V(x,T)=K_T(x)$.

Somit ist die \ac{HJB}-Gleichung für $t\in[0,T]$ unter der Randbedingung $V(x,T)=K_T(x)$ zu lösen. Die Minimalkosten sind $V(x(0),0)$ und eine optimale Zustandsrückführung ergibt sich
aus
\begin{align}
	u(x,t) & = \arg\min\limits_u\left(c(x,u,t) + \frac{\d V(x,t)}{\d x}f(x,u,t) \right).
\end{align}
\begin{remark}
Es gilt
\begin{align*}
	\left\{ \begin{array}{ll}
	y^{\ast}:=\min\limits_x f(x)	& : \text{Min. von }f\\
	x^{\ast}:=\arg\min\limits_x f(x)& : \text{Min.-stelle von }f
	\end{array}\right\} & :\Leftrightarrow f\left(x^{\ast}\right) = y^{\ast} \leq f(x) \forall x.
\end{align*}
\end{remark}

\section{Das zeitkontinuierliche \NoCaseChange{\acl{LQR}}-Problem}
Der Prozess wird beschrieben durch
\begin{align}
	\dot{x} & = A(t)x + B(t)u
\end{align}
mit dem gegebenen Anfangszustand $x(0)$. Die Systemmatrizen $A(t)$ und $B(t)$ sind stetig bezüglich der Zeit $t$.\\
Das Kostenfunktional ist gegeben mit
\begin{align}
	K\left(x(0),u \right) & := \int\limits_0^T x^TR(t)x + u^TQ(t)u dt + x(T)^TX_Tx(T),
\end{align} 
wobei $R(t)$ und $Q(t)$ stetig bezüglich der Zeit $t$ sind und $R(t)\geq 0$, $Q(t)>0\ \forall t\in[0,T]$, $X_T\geq 0$ gilt.\\
Das \ac{LQR}-Problem stellt sich wie folgt dar:
\begin{itemize}
  \item[] Finde die Rückführung $F(t)$ so, dass für $u^{\ast}(t):=F(t)x(t):\ K\left(x(0),u^{\ast} \right)$ minimal wird. 
\end{itemize}
\begin{satz}
Das \ac{LQR}-Problem wird gelöst durch die optimale Steuergröße
\begin{align}
	u^{\ast}(t) & = F(t)x(t)\quad \forall t\in[0,T],
\end{align}
mit der Rückführung $F(t)=-Q^{-1}(t)B^T(t)X(t)$ und der Riccatischen Differentialgleichung
\begin{subequations}\label{eqn:kap_3_riccatischedgl}
\begin{align}
	-\dot{X} & = R(t)+X A(t)+A^T(t)X-XB(t)Q^{-1}(t)B^T(t)X
\end{align}
mit der Endbedingung
\begin{align}
	X(T) & = X_T.
\end{align}
\end{subequations}
Dabei gilt $V\left(x(0),0 \right) = x^T(0)X(0)x(0)$.
\end{satz}
\begin{remark}
\eqnref{eqn:kap_3_riccatischedgl} ist mathematisch eine Anfangswertaufgabe (Substitution $\tau:=T-t$), somit ist die Lösung $X$ eindeutig. Mit $X$ ist auch $X^T$ eine Lösung von
\eqnref{eqn:kap_3_riccatischedgl}. Also gilt $X=X^T$.
\end{remark}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
  \item Es muss gezeigt werdem, dass $V(x(t),t)=x^T(t)X(t)x(t)$ gilt.\\
  Linke Seite der \ac{HJB}-Gleichung: Es ist $-\frac{\d V}{\d t} = -x^T\dot{X}x$.
  Rechte Seite der \ac{HJB}-Gleichung: Mit $\frac{\d V}{\d x} = 2x^TX$ gilt
  \begin{multline}
  	\min\limits_{u}\left(x^TRx + u^TQu + \left(x^TX + x^TX \right)\left(Ax + Bu \right) \right)\\
  	= \min\limits_{u}\left(x^T\left(R + XA +A^TX \right)x + x^TXBu + u^TB^TXx + u^TQ u
  	\right)\\
  	= \min\limits_{u}\left(\begin{bmatrix}
  	x^T & u^T
  	\end{bmatrix}\begin{bmatrix}
  	R + XA + A^T X & XB\\ B^TX	& Q
  	\end{bmatrix}\begin{bmatrix}
  	x\\ u
  	\end{bmatrix} \right)\\
  	 = x^T\left(R + XA + A^TX - XBQ^{-1}B^TX \right)x. \label{eqn:kap_3_zeitkont_proof}
  \end{multline} 
  \item Das Minimum \eqnref{eqn:kap_3_zeitkont_proof} wird angenommen für $u = \underbrace{-Q^{-1}B^TX}_{=:F}x$, also $u^{\ast}(t)=F(t)x(t)$.
\end{enumerate}
\end{proof}

\subsection{Übergang zu unendlichem Zeithorizont}
Der Prozess wird beschrieben durch
\begin{align}
	\dot{x} & = A x + B u
\end{align}
mit gegebenen Anfangszustand $x(0)$.\\
Das Kostenfunktional wird angegeben mit
\begin{align}
	K\left(x(0), u \right) & := \int\limits_0^{\infty}x^TRx + u^TQu dt,
\end{align}
wobei $R\geq 0$ und $Q>0$ gilt.\\
Das \ac{LQR}-Problem stellt sich wie folgt dar:
\begin{itemize}
  \item[] Finde die Rückführung $F$ so, dass für $u^{\ast}(t):=Fx(t):\ K\left(x(0),\bm{u}^{\ast} \right)$ minimal wird. 
\end{itemize}
\begin{satz}
Sei $(A,B)$ stabilisierbar und $R=\bar{R}^T\bar{R}$, $(A,\bar{R})$ ermittelbar.\\
Dann exisitert eine eindeutige positive semidefinite Lösung $X$ der \ac{ARE} 
\begin{align*}
	0 & = R+XA+A^TX-XBQ^{-1}B^TX.
\end{align*} 
Weiter ist die Rückkopplung $u^{\ast}(t)=Fx(t)$ mit $F:=-Q^{-1}B^TX$,
stabilisierend und führt zum minimalen Wert des Kostenfunktionals.
\end{satz}

\section{Beispiel der räumlichen Führung (\ac{PN})}
\subsection{Modellbildung}
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Geometrie des Problems der räumlichen Führung}
	\label{fig:kap_3_bsp_rf_geometrie}
\end{figure}
Die Geometrie des Problems der räumlichen Führung  soll vereinfachend in der Ebene betrachtet werden (siehe \figref{fig:kap_3_bsp_rf_geometrie}). In $(r,\sigma)$-Koordinaten wird es
beschrieben durch
\begin{align}
	\begin{split}\label{eqn:kap_3_bsp_rf_rskoord}
		r\dot{\sigma} & = v_1\sin(\varphi - \sigma) - v_2\sin(\gamma - \sigma)\\
		\dot{r} & = v_1\cos(\varphi - \sigma) - v_2\cos(\gamma - \sigma)
	\end{split}
\end{align}
und in $(x,y)$-Koordinaten durch
\begin{align}
	\begin{aligned}\label{eqn:kap_3_bsp_rf_xykoord}
		\dot{x}_2 & = v_2 \cos \gamma  & \qquad \dot{x}_1 & = v_1 \cos \varphi\\
		\dot{y}_2 & = v_2 \sin \gamma  & \qquad \dot{y}_1 & = v_1 \sin \varphi.
	\end{aligned}
\end{align}
Gegeben sind der Gierwinkel $\varphi(t)$, die Geschwindigkeiten $v_1(t)$ und $v_2(t)$ sowie die Anfangswerte $x_1(0)$, $y_1(0)$, $x_2(0)$, $y_2(0)$. Es gelte $v_1(t) < v_2(t)$. Mit
\begin{align}\label{eqn:kap_3_bsp_rf_sigma}
\sigma & = \left\{ \begin{array}{rl}
	\arcsin\frac{y_1-y_2}{r}	& \text{für } x_1\geq x_2\\
	\pi-\arcsin\frac{y_1-y_2}{r} & \text{für } x_1 < x_2
\end{array} \right.
\end{align}
und
\begin{align}
	r & = \sqrt{ (x_1 - x_2)^2 + (y_1 - y_2)^2 } \label{eqn:kap_3_bsp_rf_regelgesetz}
\end{align}
werden die Anfangswerte $r(0)$ und $\sigma(0)$ für \eqnref{eqn:kap_3_bsp_rf_rskoord} berechnet (zum Wertebereich von $\sigma$ siehe \figref{fig:kap_3_bsp_rf_wertebereich}). Die Funktion
$\gamma(t)$ dient als Steuerfunktion. Im Falle der sogenannten Proportionalnavigation wird das Regelgesetz
\begin{align}
	\dot{\gamma} & = a \dot{\sigma}	\label{eqn:kap_3_bsp_rf_regelgesetz}
\end{align}
verwendet, wobei für die Proportionalverstärkung $a\geq 1$ gilt.

Das Annäherungsverhalten kann mit \eqnref{eqn:kap_3_bsp_rf_rskoord} zusammen mit \eqnref{eqn:kap_3_bsp_rf_regelgesetz} simuliert werden (ergibt drei Zustandsvariablen). Soll die
Flugbahn in die Kartenebene gezeichnet werden, so wird man für die Simulation \eqnref{eqn:kap_3_bsp_rf_xykoord} zusammen mit \eqnref{eqn:kap_3_bsp_rf_regelgesetz} (ergibt fünf
Zustandsvariablen), wobei die erforderliche Messgröße $\dot{\sigma}$ entweder aus \eqnref{eqn:kap_3_bsp_rf_rskoord} (weitere zwei Zustandsvariablen) oder ohne Vergrößerung der Anzahl
der Zustandsvariablen wie folgt berechnet wird. Mit
\begin{align}
	\zeta & := \begin{bmatrix}
	y_2 - y_1\\
	x_1 - x_2
	\end{bmatrix},\quad \zeta_0:=\frac{\zeta}{\left\| \zeta \right\|_2},\quad \alpha_1:=\zeta_0^T\begin{bmatrix}
	\dot{x}_1 \\ \dot{y}_1
	\end{bmatrix},\quad \alpha_2:=\zeta_0^T\begin{bmatrix}
	\dot{x}_2\\ \dot{y}_2
	\end{bmatrix}
\end{align}
und wegen $\alpha_1 = v_1 \sin(\varphi - \sigma)$, $\alpha_2 = v_2 \sin(\gamma - \sigma)$ (siehe \figref{fig:kap_3_bsp_rf_geschwindigkeit}), $r = \left\|\zeta \right\|_2$ und
\eqnref{eqn:kap_3_bsp_rf_rskoord} erhält man
\begin{align}
	\dot{\sigma} & = \frac{\zeta_0^T\left( \begin{bmatrix}
	\dot{x}_1 \\ \dot{y}_1
	\end{bmatrix} - \begin{bmatrix} 
	\dot{x}_2 \\ \dot{y}_2
	\end{bmatrix}\right)}{\left\| \zeta \right\|_2}.	\label{eqn:kap_3_bsp_rf_messgroesse}
\end{align}
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{$\sigma$-Wertebereich für $x_2=y_2=0$ und $(x_1,y_1)$ auf dem Kreis $\mathcal{K}$}
	\label{fig:kap_3_bsp_rf_wertebereich}
\end{figure}
\begin{remark}
Die Berechnung der Ableitung erfolgt in \eqnref{eqn:kap_3_bsp_rf_messgroesse} ohne die Verwendung von Winkelfunktionen. Alternativ kann $\dot{\sigma}$ auch über
$r\dot{\sigma}=v_1\sin(\varphi - \sigma)-v_2\sin(\gamma - \sigma)$ bestimmt werden. Das dafür nötige $\sigma$ wird mittels \eqnref{eqn:kap_3_bsp_rf_sigma} bestimmt. Das dabei nur die
Einschränkung der Sinus-Funktion auf $\left[-\frac{\pi}{2},\frac{3}{2}\pi \right]$ betrachtet wird und damit bei einer kontinuierlichen Bewegung des Körpers 2 auf einer Kreisbahn um den Körper 1 bei
$\sigma = -\frac{\pi}{2}$ ein Sprung der Höhe $2\pi$ auftritt (\figref{fig:kap_3_bsp_rf_wertebereich}), ist unproblematisch, da dieser Sprung durch die Periodizität der Sinunsfunktion
nicht in den Funktionswerten $\sin(\varphi - \sigma)$ und $\sin(\gamma - \sigma)$ erscheint.
\end{remark}
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Komponenten der Geschwindigkeitsvektoren}
	\label{fig:kap_3_bsp_rf_geschwindigkeit}
\end{figure}

\subsection{Parallele Annäherung als Spezialfall der \ac{PN}}
Für die nacholgenden Betrachtungen wird angenommen, dass $\varphi$, $v_1$ und $v_2$ konstante Größen sind. Dann stellt sich für $a\rightarrow +\infty$ in
\eqnref{eqn:kap_3_bsp_rf_regelgesetz} im Regelkreis der mit dem Index $o$ bezeichnete Arbeitspunkt $\dot{\sigma}_o=0$ ein (siehe \figref{fig:kap_3_bsp_rf_methode}).\\
Aus der ersten Gleichung in \eqnref{eqn:kap_3_bsp_rf_rskoord} folgt dann
\begin{align}
	\gamma_o & = \sigma_o + \arcsin\frac{v_1 \sin(\varphi - \sigma_o)}{v_2},
\end{align}
also insbesondere $\dot{\gamma}_o=0$, und die zweite Gleichung liefert die konstante Annäherungsgeschwindigkeit $\dot{r}_o<0$. Für die Herleitung der Gleichungen für den Lenkregelkreis
reicht es aus, die erste Gleichung in \eqnref{eqn:kap_3_bsp_rf_rskoord} zu betrachten. Wir betrachten kleine Abweichungen $\Delta r$, $\Delta \sigma$, $\Delta\dot{\sigma}$, $\Delta
\gamma$ vom Arbeitspunkt. Die Linearisierung von \eqnref{eqn:kap_3_bsp_rf_rskoord} erfolgt durch Bilden des vollständigen Differentials für beide Seiten am Arbeitspunkt
\begin{align}
	r_o\cdot\Delta\dot{\sigma}+\dot{\sigma}_o\cdot\Delta r & = -v_2\cos(\gamma_o-\sigma_o)\cdot\Delta\gamma - \left(v_1\cos(\varphi - \sigma_o) - v_2\cos(\gamma_o -
	\sigma_o)\right)\cdot\Delta\sigma .
\end{align}
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Methode der parallelen Annäherung}
	\label{fig:kap_3_bsp_rf_methode}
\end{figure}
Bei Berücksichtigung von $\dot{\sigma}_o=0$ und Vergleich der Koeffizienten von $\Delta\sigma$ mit der zweiten Gleichung in \eqnref{eqn:kap_3_bsp_rf_rskoord} erhält man
\begin{align}
r_o\cdot\Delta\dot{\sigma}+\dot{r}_o\cdot\Delta\sigma & = -v_2\cos(\gamma_o - \sigma_o)\cdot\Delta\gamma.
\end{align}
Die Division durch $|\dot{r}_o|$ liefert mit der Restlaufzeit $T_f(t):=\frac{r_o}{|\dot{r}_o|}=\frac{r(0)}{|\dot{r}_o|} - t=t_f - t$ bis zum Endzeitpunkt $t_f$ und der
Verfolgergeschwindigkeit $\beta_2 := v_2\cos(\gamma_o - \sigma_o)\in(0,v_2]$ entlang der Sichtlinie die lineare und wegen des Koeffizienten $T_f(t)$ zeitvariante Differentialgleichung
erster Ordnung
\begin{align}
	T_f\cdot\Delta\dot{\sigma}-\Delta\sigma & = -\beta_2\cdot\Delta\gamma .
\end{align}
Durch Differentiation der Gleichung erhalten wir eine Differentialgleichung für $\Delta\dot{\sigma}_o$
\begin{align}
	T_f\cdot\Delta\ddot{\sigma} + \dot{T}_f\cdot\Delta\dot{\sigma}-\Delta\dot{\sigma} & = -\beta_2\cdot\Delta\dot{\gamma},
\end{align}
woraus wegen $\dot{T}_f=-1$
\begin{align}
	T_f\cdot\Delta\ddot{\sigma}-2\cdot\Delta\dot{\sigma} & = -\beta_2\cdot\Delta\cdot{\gamma}
\end{align}
folgt. Wir schreiben kürzer für Zustandsvariable $x:=\Delta\dot{\sigma}$ und für die Steuergröße $u:=\Delta\dot{\gamma}$ und erhalten die Lösung der Differentialgleichung im Intervall
$[t_0,t]\subset[0,t_f]$
\begin{align}
	x(t) & = \frac{\beta_2\int_{t_0}^t(\tau - t_f)u(\tau)d\tau + (t_0-t_f)^2x(t_0) }{(t-t_f)^2}.
\end{align}
Für die stückweise konstante Steuerfunktion $u(t)=const.$ für $t\in[t_k,t_{k+1})$ erhält man mit den Bezeichnungen $u[k]:=u(t_k)$ und $x[k]:=x(t_k)$ die zeitdiskrete Prozessbeschreibung
\begin{align}\label{eqn:kap_3_bsp_rf_ressys}
	x[k+1] & = \underbrace{\frac{(t_k-t_f)^2}{(t_{k+1}-t_f)^2} }_{A_k}x[k] + \underbrace{\frac{\beta_2\int_{t_k}^{t_{k+1}}(\tau - t_f)d\tau }{(t_{k+1}-t_f)^2} }_{B_k}u[k].
\end{align}
\begin{table}[htb]
\caption{Parameter des zeitvarianten Systems und \ac{LQR}-Regler aus \exmpref{exmp:kap_3_bsp_rf_c2}}
\centering
\begin{tabular}{|c|r|r|r|}
	\hline
	k 	& $A_k$		& $B_k$		& $F_k$	\\\hline
	0	& 1.1688	& -0.0422	& 5.7838\\
	1	& 1.1843	& -0.0461	& 5.7668\\
	2	& 1.2030	& -0.0507	& 5.7470\\
	3	& 1.2258	& -0.0564	& 5.7235\\
	4	& 1.2545	& -0.0636	& 5.6953\\
	5	& 1.2914	& -0.0728	& 5.6606\\
	6	& 1.3409	& -0.0852	& 5.6170\\
	7	& 1.4104	& -0.1026	& 5.5605\\
	8	& 1.5151	& -0.1288	& 5.4845\\
	9	& 1.6906	& -0.1726	& 5.3765\\
	10	& 2.0421	& -0.2605	& 5.2107\\
	11	& 3.0673	& -0.5168	& 4.9214\\
	12	& 16.1787	& -3.7942	& 4.2611\\\hline
\end{tabular}
\label{tab:kap_3_bsp_rf_parameter}
\end{table}
\begin{exmp}\label{exmp:kap_3_bsp_rf_c2}
Aus den Anfangswerten
\begin{align*}
	x_1(t_0) & = 10,\quad y_1(t_0) = 0.33,\quad x_2(t_0) = 0,\quad y_2(t_0)=0
\end{align*}
und den als zeitlich konstant angenommenen Größen
\begin{align}
	v_1(t) & = 0.2,\quad v_2(t) = 0.5,\quad \phi(t)=-\pi\qquad\forall t\in[0,t_f]
\end{align}
erhält man für die Methode der parallelen Annäherung die Anfangswerte
\begin{align}
	\gamma(0) & = 0.049,\quad \sigma(0)=0.033,\quad t_f=13.33.
\end{align}
Betrachtet man das resultierende System \eqnref{eqn:kap_3_bsp_rf_ressys} auf den Zeitintervallen $[t_k,t_{k+1}]$ ($k=0,1,\ldots,12$), so ergeben sich die in
\tabref{tab:kap_3_bsp_rf_parameter} dargestellten Werte für $A_k$ und $B_k$. Für dieses System wird ein zeitvarianter \ac{LQR}-Regler $F_k$ nach Satz ? berechnet, wobei für die
Gewichtungsmatrizen $R=0$, $Q=1$, $X_{12}=100$ gesetzt wird, d.h. neben den Steuergrößen soll allein die Abweichung des Zustandes im Endzeitpunkt vom Sollwert $0$ minimiert werden. Für
eine Anfangsabweichung $x[0]=\Delta\dot{\sigma}[0]=0.05$ vom Sollwert zeigt \figref{fig:kap_3_bsp_rf_verlauf_regelgroesse} den mit $x_{LQR}[k]$ bezeichneten Verlauf der Zustandsgröße
für den \ac{LQR}-Regler im Vergleich zu den mit $x_{PN}$ bezeichneten Verlauf für den Fall, dass die Steuergröße mit einem zeitlich konstanten Regler berechnet wird, wobei hier konkret
der \ac{LQR}-Regler zum Zeitpunkt $k=10$ eingesetzt wird, d.h. es gilt
\begin{align}
	u_{PN}[k] & = F_{10}\cdot x_{PN}[k]. \label{eqn:kap_3_bsp_rf_bsp_konst_regler}
\end{align}
In \figref{fig:kap_3_bsp_rf_verlauf_steuergroesse} sind die zugehörigen Verläufe der Steuergröße dargestellt. Man erkennt, dass der zeitvariante \ac{LQR}-Relger die Zustandsgröße im
Endzeitpunkt $k=13$ nahe an den Zielzustand $0$ bringt, während der zeitlich konstante Regler $F_{10}$ gegenüber dem \ac{LQR}-Regler anfangs eine "`zu kleine"' und am Ende des
Zeithorizontes eine "`zu große"' Verstärkung aufweist.
\end{exmp}
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Verlauf der Regelgröße für das \exmpref{exmp:kap_3_bsp_rf_c2}}
	\label{fig:kap_3_bsp_rf_verlauf_regelgroesse}
\end{figure}
\begin{figure}[htb]
	\centering
	\input{tikz/dummy}
	\caption{Verlauf der Steuergröße für das \exmpref{exmp:kap_3_bsp_rf_c2}}
	\label{fig:kap_3_bsp_rf_verlauf_steuergroesse}
\end{figure}
Es sind zwei Übungen unter \picref{sec:uebung_raeumliche_fuehrung}{Beispiel der räumlichen Führung} im Anhang zu finden.
